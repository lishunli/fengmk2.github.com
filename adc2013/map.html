<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>ADC 2013 参会统计</title>
  <script src="./js/jquery-1.7.2.js"></script>
  <script src="./js/raphael.js"></script>
  <script src="./js/gender.js"></script>
  <script src="./js/datav.js"></script>
  <script src="./js/chinamap.js"></script>
<style type="text/css">
body {
  font-family: "Microsoft YaHei"!important;
  font-size: 14px;
}

.head {
  margin: 5px;
  overflow: hidden;
  font-size: 16px;
  color: #666;
  padding-left: 4px;
}

.gender_box {
  float: right;
}

.gender_chart {
  padding: 10px;
  margin: 10px;
  height: 235px;
  width: 300px;
  overflow: hidden;
  float: left;
}
#wrap {
  width: 940px;
}

#chart {
  float: left;
}
</style>
</head>

<body>
  <div id="wrap">
    <div id="chart">
      <div class="head">
        <span>全国参会情况</span>
      </div>
    </div>

    <div class="gender_box">
      <div class="head">
        <span>全国性别比例</span>
      </div>
      <div class="gender_chart"></div>
    </div>
  </div>
<script>

var total = {
  allGender: [75, 25], // 全国性别比例，男，女
  hangzhouGender: [85, 15], // 杭州性别比例，男，女
  provinces: [
    {name: '浙江', rate: 30}, // 名称和占比
    {name: '北京', rate: 10},
    // ...
    {name: '新疆', rate: 1}
  ],
  cities: [
    {name: '杭州', rate: 10}, // 城市和占比
    // ...
    {name: '东莞', rate: 0.5}
  ],
  cityMap: {},
  domains: [ // 关注技术领域
    {name: '业务架构与后端技术', rate: 20}, // 技术领域名称和占比
    // ...
  ],
  tags: [ // 个性标签
    {name: '技术宅', rate: 40}, // 个性标签名称和占比
    // ...
  ]
};
total.provinceRates = {};
for (var i = 0; i < total.provinces.length; i++) {
  var p = total.provinces[i];
  total.provinceRates[p.name] = p.rate;
}

var genderChart0 = new GenderChart($('.gender_chart:eq(0)'));
genderChart0.render(total.allGender);

var pointColor = "#E67E22";
var highlightedCityPoint; //raphael obj

var data = {
  cities: [
    {'name': '上海', rate: 5},
    {'name': '北京', rate: 6},
    {'name': '杭州', rate: 25},
    {'name': '广州', rate: 25},
    {'name': '苏州', rate: 7},
    {'name': '宁波', rate: 45},
    {'name': '克拉玛依', rate: 55},
    {'name': '九江', rate: 65},
    {'name': '厦门', rate: 8},
    {'name': '常州', rate: 9},
    {'name': '哈尔滨', rate: 215},
    {'name': '无锡', rate: 1},
    {'name': '南京', rate: 10},
    {'name': '大连', rate: 2}
  ]
};

total.cities.sort(function (a, b) {
  return a.rate - b.rate;
});

total.cityMap = {};
total.cities.forEach(function (d) {
  total.cityMap[d.name] = d;
});

var highlightCityPoint = function (cityName) {
  var cityData = total.cityMap[cityName];
  if (!cityData) {
    return;
  }
  highlightedCityPoint = chinamap.createCityPoints([cityData], function (city) {
    return this.paper.circle(city.coord[0], city.coord[1], 30)
    .attr({
      "stroke-width": 4,
      "stroke": "steelblue",
      "fill": "#fff"
    })
    .data("cityInfo", city)
    .mouseout(function () {
      //lowlightCity(city.name);
      chinamap.fire("cityMouseout", city.name);
    });
  })[0];
  var cityInfo = highlightedCityPoint.data("cityInfo");
  chinamap.floatTag.html("<p>" + cityInfo.name + "</p>"
    + "<p>排名：" + cityInfo.index + "</p>"
    + "<p>占比：" + cityInfo.rate + "%</p>").css("visibility", "visible");
  chinamap.floatTag.creator.changeLoc(cityInfo.pointLoc);
};

var lowlightCityPoint = function () {
  if (typeof highlightedCityPoint !== 'undefined') {
    highlightedCityPoint.remove();
    highlightedCityPoint = undefined;
    chinamap.floatTag.css("visibility", "hidden");
  }
};

var w = 600;
var h = 450;
$("#chart").css({"width": w});

var chinamap = new Chinamap("chart", {
  'width': w,
  'height': h,
  'geoDataPath': './js/chinaMap/',
  showWords: false,
});
// chinamap.setOptions({'showWords': false});
chinamap.setOptions({'levelChangeable': false});
chinamap.setOptions({'mapId': 0});

chinamap.setOptions({
  colorModel: "gradient",
  colors: ["#eee", "#3498DB"]//设置渐变颜色
});
//2010 人口统计
chinamap.setSource(total.provinceRates);

chinamap.renderCallback = function () {
  var createPoints = function (cityArray, fillColor) {
    chinamap.createCityPoints(cityArray, function (city) {
      this.paper.circle(city.coord[0], city.coord[1], 20)
      .attr({
          "stroke": "none",
          "fill": fillColor,
          "fill-opacity": 0.5
          })
      .data("map", this)
      .data("cityInfo", city)
      .mouseover(function () {
        //highlightCity(city.name);
        chinamap.fire("cityMouseover", city.name);
      });
    });
  };

  createPoints(total.cities, pointColor);

  chinamap.on("cityMouseover", highlightCityPoint);
  chinamap.on("cityMouseout", lowlightCityPoint);
  
  chinamap.createCityPoints(total.cities, function (city) {
    this.paper.circle(city.coord[0], city.coord[1], 20)
    .attr({
      "stroke": "none",
      "fill": pointColor,
      "fill-opacity": 0.5
    })
    .data("map", this)
    .data("cityInfo", city)
    .mouseover(function () {
      chinamap.fire("cityMouseover", city.name);
    });
  });
          
  chinamap.floatTag.creator.mouseToFloatTag({x: 10, y: 10});
};

chinamap.render();
</script>
  </body>
</html>
